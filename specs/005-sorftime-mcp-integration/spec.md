# 需求 005: Sorftime MCP 服务集成

## 1. 概述

集成 Sorftime MCP (Multi-Channel Platform) 服务，实现自动化的亚马逊产品数据抓取与导入流程。用户只需提供简单的输入（ASIN、产品名、Node ID 或 URL），系统即可自动识别类目，抓取 Top 100 排名数据，并自动对接现有的数据导入和处理流程。

## 2. 背景与目标

目前系统依赖用户手动上传 CSV/XLSX 文件。为了提高效率，我们需要直接对接数据源。Sorftime 提供了 MCP 服务，可以通过 API 获取实时的亚马逊类目排名数据。

**目标**：
1. 实现与 Sorftime MCP 服务的对接。
2. 支持多种输入方式（ASIN、URL、关键词等）触发数据抓取。
3. 抓取的数据自动进入现有的"导入-清洗-提取"工作流。

## 3. 详细需求

### 3.1 输入处理
支持以下类型的输入：
- **ASIN**: 亚马逊标准识别号 (e.g., B08XXXXXXX)
- **URL**: 亚马逊产品详情页或类目页 URL
- **Node ID**: 亚马逊类目节点 ID
- **产品名/关键词**: 用于搜索并匹配类目

### 3.2 MCP 服务交互
- **认证**: 使用 Account-SK (`t1hsvi9nwjr1cwhgwwtmvevvwez4dz09`) 进行鉴权。
- **API 调用**: 访问 `https://mcp.sorftime.com` 获取数据。
- **数据获取**: 获取指定类目的 Top 100 排名产品详细信息。

### 3.3 数据处理流程
1. **识别**: 解析用户输入，确定目标类目 (Node ID)。
2. **抓取**: 调用 MCP API 获取数据。
3. **转换**: 将 MCP 返回的 JSON 数据转换为系统可识别的格式 (DataFrame/CSV)。
4. **导入**: 调用现有的 `ImportService` 将数据存入数据库。
5. **反馈**: 向用户展示抓取进度和结果。

## 4. 用户界面 (UI)

在前端添加一个新的"智能抓取"入口：
- 输入框：支持多行输入或单一输入。
- 抓取按钮：启动任务。
- 状态面板：显示"正在识别类目" -> "正在抓取数据" -> "正在导入" -> "完成"。

## 5. 非功能需求
- **响应速度**: 抓取过程可能较慢，需要异步处理或进度提示。
- **错误处理**: 妥善处理 MCP 服务超时、鉴权失败、无数据等情况。
- **可扩展性**: 预留接口以支持更多 MCP 功能。
