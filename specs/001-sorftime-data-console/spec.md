# Feature Specification: Sorftime 数据智能控制台

**Feature Branch**: `001-sorftime-data-console`  
**Created**: 2025-11-15  
**Status**: Draft  
**Input**: User description: "我是一个亚马逊选品人员，需要对很多的亚马逊 asin 进行横向对比，目前通过 sorftime 等工具下载的信息表格没有完全满足我的需求，我希望能在现有数据的基础上进行深度分析 功能： 1. 导入：导入来自 sorftime 的表格，里面包含多个产品信息 2. 存储：将这些文件存储到数据库中 3. 查询：可以通过类似 chatgpt 的方式询问本地数据库（通过接入 deepseek api来完成） 4. 导出：可以选择想要的字段进行导出 同时 需要一个 Web 管理后台，用来让运营人员完成日常导入与数据核查。后台应具备： 1. 统一、美观、可扩展的前端框架（优先考虑基于 React/Ant Design 或类似方案），要求支持主题/布局、自适应、权限路由等基础设施，方便以后新增模块。 2. “文件导入”模块：页面可上传 Sorftime CSV/XLSX，选择导入策略、查看实时状态、查看历史批次列表。 3. “数据查询”模块：可按批次 ID/ASIN/状态过滤导入结果，展示产品清洗后的字段，并支持导出失败行。 4. “数据导出”模块：允许按条件导出标准化产品或批次失败行，输出 CSV/Excel，记录导出日志，便于追踪。 5.后台管理系统挑选合适的前端/后端技术，请 speckit 根据需求给出推荐的框架和理由（UI 框架、状态管理、表格/图表组件、后端服务栈、部署方式等）"

## User Intent & Scope *(mandatory)*

- **User Promise**: “我是一个亚马逊选品人员，需要对很多的亚马逊 ASIN 进行横向对比……希望能在现有数据的基础上进行深度分析”，因此本特性承诺提供一个能导入 Sorftime 文件、集中存储并支持智能查询和导出的运营控制台。
- **In Scope**:
  - 上传 Sorftime CSV/XLSX、跟踪导入批次状态并将解析后的产品字段写入本地数据存储。
  - 建立批次、产品、导出日志等数据视图，支持按批次 ID、ASIN、状态等条件检索。
  - 连接 Deepseek API，提供类似 ChatGPT 的自然语言问答体验，依托本地数据库返回可追溯答案。
- 允许运营选择字段与过滤条件导出标准化产品或失败记录，并记录导出日志。
- 在 Web 管理后台中交付文件导入、数据查询、数据导出等模块，并提供统一、可扩展的 UI 基础设施。
- 输出一份推荐的前端/后端技术选型方案及其理由，方便后续实现。
- 前端框架选择说明：用户偏好 React/Ant Design，本方案采用 Vue 3 + Vue Element Admin，原因是复用现有 Vue 资产与团队经验以加速交付；若需 React 版本需追加评估并与用户确认。
- **Out of Scope**:
  - 与 Amazon 平台或 Sorftime API 的实时同步（仅处理手工上传文件）。
  - 构建最终线上部署流水线或账号权限管理系统（此阶段聚焦需求验证与后台能力定义）。
  - 自研大模型或训练数据；Deepseek API 仅作为外部能力，若需更换模型将在后续版本评估。

## User Scenarios & Testing *(mandatory)*

### User Story 1 - Sorftime 文件批次导入与存储 (Priority: P1)

作为亚马逊选品运营，我要在后台上传 Sorftime 导出的 CSV/XLSX，并在导入过程中查看字段映射、冲突告警与批次进度，完成后能在批次列表中核查清洗结果与失败原因。
**Why this priority**: 没有可靠的批次导入能力，就无法为下游查询与导出提供数据基础，是整个系统的起点。
**Independent Test**: 上传一份 Sorftime 示例文件，观察批次状态更新、字段清洗结果与失败日志，确认数据写入后即可结束。
**Acceptance Scenarios**:
1. **Given** 运营选择 Sorftime 模板文件，**When** 选择导入策略并提交，**Then** 系统展示实时进度并生成批次 ID。
2. **Given** 批次包含格式错误的行，**When** 导入任务完成，**Then** 失败行被标记并可在失败列表中查看原因或导出。

---

### User Story 2 - 自然语言数据洞察 (Priority: P2)

作为选品分析师，我希望用自然语言向系统提问（例如“列出近两次导入中销量排名前十的 ASIN”），系统借助 Deepseek API 与本地数据库返回结构化答案并附上引用字段。

**Why this priority**: 运营依赖灵活问答来快速洞察产品表现，此能力提升使用门槛和效率。
**Independent Test**: 构造几条典型问题，验证系统能解析意图、读取本地数据并返回含字段引用的回答。
**Acceptance Scenarios**:
1. **Given** 系统已有多个批次数据，**When** 用户提出聚合或筛选问题，**Then** 界面返回答案、引用的批次/字段以及 Deepseek 交互记录。
2. **Given** Deepseek API 暂时不可用，**When** 用户提问，**Then** 系统提示外部服务异常并提供改为结构化筛选的备选路径。
---

### User Story 3 - 数据导出与运营稽核 (Priority: P3)

作为运营主管，我要在后台筛选批次/ASIN/字段并导出 CSV/Excel，还要查看导出日志、失败记录，并阅读平台推荐的前后端技术方案以规划后续建设。
**Why this priority**: 导出与稽核保障数据可复用、可追踪，同时技术选型建议直接关系到下一阶段实施。
**Independent Test**: 选择不同筛选条件发起导出任务，检查生成文件、日志记录；查阅技术推荐文档确认覆盖 UI/状态管理/后端栈/部署方案。
**Acceptance Scenarios**:
1. **Given** 运营勾选特定字段和过滤条件，**When** 发起导出，**Then** 系统生成所需格式文件并记录导出人、时间、条件。
2. **Given** 导出任务出现失败，**When** 用户查看日志，**Then** 能看到失败原因并可单独导出失败行进行复核。
---

[Add more user stories as needed, each with an assigned priority]

### Edge Cases

- Sorftime 模板字段发生变更或缺失，上传时必须提示并允许重新映射或下载最新模板。
- 同一 ASIN 在不同批次重复导入时，需说明去重/覆盖策略（例如以最新批次为准并保留历史版本）。
- Deepseek API 延迟或失败超过阈值时的降级方案（切换到面板式筛选或提示稍后重试）。
- 大批量导出（>50k 行）时的分段处理与超时提示，确保不会阻塞前端会话。
- 运营误删批次或导出日志需可恢复或至少记录审计线索。

## Requirements *(mandatory)*

### Functional Requirements

- **FR-001**: 系统必须支持上传 Sorftime CSV/XLSX，并允许选择导入策略（覆盖、追加、仅更新）及字段映射校验。
- **FR-002**: 导入服务必须在批次层面记录状态、进度、成功/失败行数，并可在后台列表与详情中查看。
- **FR-003**: 清洗后的产品数据必须持久化到数据库，包含基础属性、销量、价格、评分等 Sorftime 字段以及解析时间戳。
- **FR-004**: 系统必须提供批次、ASIN、状态等过滤条件的列表视图，并能展示失败行明细及导出失败行。
- **FR-005**: Conversational 查询入口必须收集用户意图，调用 Deepseek API 获取自然语言结果，并附带引用的本地数据字段或仪表。
- **FR-006**: 查询界面需在 Deepseek 不可用时提供结构化筛选替代方案，并在日志中记录失败原因与重试情况。
- **FR-007**: 数据导出模块必须允许选择字段与过滤条件，输出 CSV/Excel，并对每次导出记录操作者、时间、条件与结果。
- **FR-008**: 系统必须输出一份技术选型建议，覆盖 UI 组件框架、状态管理策略、表格/图表组件、后端服务栈与部署方式，同时给出每项推荐理由。
- **FR-009**: 后台需支持主题/布局、自适应、基础权限路由等可扩展基础设施，以便未来增删模块。
- **FR-010**: 所有用户操作（导入、查询、导出、问答）需写入审计日志，至少保留 180 天以支持追溯。

### Key Entities *(include if feature involves data)*

- **ImportBatch**: 记录批次 ID、上传者、导入策略、状态、统计数字、执行时间以及失败摘要；关联多个 ProductRecord。
- **ProductRecord**: 保存单个 ASIN 在特定批次的清洗结果，包括 Sorftime 字段、派生指标、校验状态、所属批次 ID。
- **QuerySession**: 存储自然语言问题、解析意图、Deepseek 交互日志、引用的数据范围、响应状态，用于审计与优化提示词。
- **ExportJob**: 描述导出类型（标准化产品或失败行）、过滤条件、字段集合、文件格式、生成状态以及下载链接。

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: 运营可在 5 分钟内完成 50MB Sorftime 文件的导入，并获得 100% 的批次状态可见性（实时进度+失败行列表）。
- **SC-002**: 自然语言查询在 90% 的问题上于 10 秒内返回结果，并至少引用一个本地字段帮助验证答案。
- **SC-003**: 数据导出任务中 95% 在 2 分钟内完成，且每次导出自动生成可追溯日志。
- **SC-004**: 运营满意度调查中，≥80% 用户认为新后台能满足横向对比和数据稽核需求。

## Observability & Quickstart *(mandatory)*

- **Instrumentation Plan**: 
  - 为导入、查询、导出分别打点记录耗时、成功率、失败原因，并对 Deepseek API 调用计数/错误率进行监控。
  - 将关键批次和查询事件推送到统一审计日志，便于追踪哪位运营触发了何种操作。
  - 设置阈值告警：批次失败率>5% 或 Deepseek 响应>15 秒需通知维护人员。
- **Manual Verification**:
  - 在 quickstart 中提供上传样例、触发查询、执行导出和查看技术选型文档的步骤，确保新成员 30 分钟内可完成端到端操作。
  - 验证日志页面是否记录了上述操作以及引用字段区块是否完整。
- **Owner**: 运营平台产品负责人负责在上线前复核仪表与 quickstart，确保可观测性达标。

## Assumptions & Dependencies

- Sorftime 文件字段结构与客户现有模板保持一致；若未来版本变动，将以配置驱动方式扩展。
- Deepseek API 凭证由企业账户提供，允许本项目在受控网络内调用。
- 运营后台用户已通过统一身份系统完成认证与权限分配，此特性仅处理模块内的权限路由配置。
