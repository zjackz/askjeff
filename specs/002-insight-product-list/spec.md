# Feature Specification: 数据洞察页面产品列表化改版

**Feature Branch**: `002-insight-product-list`  
**Created**: 2025-11-18  
**Status**: Draft  
**Input**: 用户原始需求：“修改数据洞察页面，主界面改为上传的产品列表展示（带完整的查询功能），chat 功能已悬浮框方式固定在右下角，点击时进弹出进行交互”

> **语言要求**：本规格及后续代码、文档、注释均需使用中文，保留的英文技术术语需附中文含义。

## 用户意图与范围

- **用户承诺**：让运营/分析人员在数据洞察页面直接浏览并筛选已上传的产品记录，同时保留可随时唤起的对话式洞察入口，提高查找与分析效率。
- **范围内**：
  - 数据洞察页面主区域展示产品列表（基于已导入的数据），支持完整筛选、搜索、排序与分页。
  - 列表行可查看产品详情或失败原因等补充信息，确保核查流程在线完成。
  - 页面右下角提供悬浮 chat 入口，点击弹出对话框进行问答，不遮挡列表主要操作区域。
  - 为空数据、加载错误、网络异常等状态提供清晰反馈与可重试入口。
- **范围外**：
  - 不变更导入管道或产品字段清洗逻辑，仅复用已存在的数据。
  - 不新建独立聊天后端或模型，仅调整聊天在页面内的入口与布局。
  - 不新增权限体系，沿用现有的统一身份与页面访问控制。

## 用户故事与测试

> 每个故事需独立交付（P1 为最高优先级），包含可验证的验收场景。

### User Story 1 - 在页面内精准筛选上传产品 (P1)

- **描述**：作为运营人员，我希望在数据洞察页面直接按批次、ASIN、状态等条件筛选上传的产品列表，并快速查看行详情。
- **优先级原因**：筛选/核查是日常高频动作，直接在页面完成可显著缩短链路。
- **独立验证**：准备含多个批次/状态的测试数据，验证列表可筛选、排序、分页并打开行详情。
- **验收场景**  
  1. **Given** 页面存在多个批次的产品，**When** 按批次 ID、ASIN 关键词与状态组合过滤，**Then** 列表仅显示符合条件的产品，并支持分页与排序。  
  2. **Given** 列表返回结果，**When** 点击某行，**Then** 弹出/侧滑展示该产品的核心字段、所属批次及失败原因（若有）。  
  3. **Given** 查询结果为空，**When** 页面渲染，**Then** 显示空态文案与“清除筛选/重新加载”操作。

---

### User Story 2 - 悬浮 chat 辅助洞察 (P2)

- **描述**：作为分析人员，我希望在浏览产品列表时随时打开右下角 chat 悬浮框，与系统对话获取额外洞察，不打断当前浏览。
- **优先级原因**：即时提问与结果核查提升分析效率，避免在多页面切换。
- **独立验证**：在列表页执行筛选后，打开 chat 进行提问，验证弹出体验、交互可用性与异常提示。
- **验收场景**  
  1. **Given** 页面加载完毕，**When** 点击右下角悬浮 chat 入口，**Then** 弹出对话框，可输入问题并查看回复，关闭后回到原列表状态。  
  2. **Given** chat 服务暂不可用，**When** 用户点击发送，**Then** 显示友好错误提示与重试/反馈入口，不影响列表继续使用。

---

### User Story 3 - 导出筛选条件与复核 (P2)

- **描述**：作为运营/分析人员，我希望在列表页导出当前筛选条件和结果快照，便于离线复核或共享。
- **优先级原因**：减少重复筛选与沟通成本，提升核查效率。
- **独立验证**：设置组合筛选后导出，校验导出文件/JSON 含筛选条件与分页范围；刷新页面确认默认空筛选。
- **验收场景**  
  1. **Given** 已设置批次/ASIN/状态筛选，**When** 点击“导出当前筛选”，**Then** 生成包含筛选条件与当前页结果的文件或下载链接。  
  2. **Given** 导出失败或队列繁忙，**When** 用户点击导出，**Then** 显示错误原因与重试/排队提示，不影响列表继续操作。  

---

### 边界情况

- 未上传产品或筛选结果为空时，展示空态说明及“清除筛选/去上传/刷新”入口。
- 查询条件过多导致无匹配时，提示用户简化条件并提供一键重置。
- 列表请求失败或超时时，展示错误状态与重试按钮，不阻塞 chat 悬浮入口。
- 大数据量分页滚动时，维持固定的 chat 悬浮入口位置，并保证筛选条件保持生效。
- 用户在打开详情或 chat 时刷新页面，需恢复默认视图并允许重新进行操作。

## 需求

### 功能需求

- **FR-001**：数据洞察主区域默认展示上传产品列表，至少包含 ASIN、标题、批次 ID、状态、最近更新时间等核心列，并支持列宽自适应与列排序。
- **FR-002**：列表必须支持组合查询（批次 ID、ASIN 关键词、状态、时间范围、其他关键字段），并提供分页、排序、重置筛选及导出当前筛选条件的能力。
- **FR-003**：列表行点击后可在同页弹出详情视图，展示完整字段、所属批次信息及失败原因/校验状态，返回列表时保持原有筛选与滚动位置。
- **FR-004**：页面右下角常驻一个 chat 悬浮入口，滚动不消失；点击后以弹出方式开启对话，关闭后列表可继续操作且不被遮挡。
- **FR-005**：chat 弹窗需支持多轮问答的基本体验（输入、发送、展示回复、失败提示），发送失败时提示原因并提供重试。
- **FR-006**：列表与 chat 均需提供加载中、空态、错误态的可见反馈，并允许用户重试或清除筛选。
- **FR-007**：用户的筛选条件在同一浏览会话内保持有效，页面刷新后回到默认空筛选状态。
- **FR-008**：支持导出当前筛选条件及当前页结果，导出失败需提示并可重试。

### 关键实体

- **产品记录（ProductItem）**：描述已上传的单个产品，含 ASIN、标题、批次 ID、当前清洗状态、最近更新时间、核心指标等。
- **查询条件（QueryFilter）**：表示用户在页面上设置的筛选与排序选项，包括批次 ID、ASIN 关键词、状态、时间范围及页码信息。
- **聊天会话（ChatSession）**：记录在页面内发起的问答交互，含问题、回复、时间戳及错误提示状态。

### 数据模型

#### 产品记录（ProductItem）
- `id`：唯一标识
- `asin`：ASIN 编号
- `title`：产品标题
- `batch_id`：所属导入批次 ID（关联 ImportBatch）
- `status`：清洗/校验状态（success/failed/pending）
- `last_updated_at`：最近更新时间
- `metrics`：核心指标摘要（价格、销量、评分等）
- `failure_reason`：失败或校验提示（可为空）

#### 查询条件（QueryFilter）
- `batch_id`（可选）：批次 ID
- `asin_keyword`（可选）：ASIN 或标题关键词
- `status`（可选）：状态过滤
- `updated_from` / `updated_to`（可选）：更新时间范围
- `page` / `page_size`：分页信息
- `sort_by` / `sort_order`：排序字段及方向

#### 聊天会话（ChatSession）
- `session_id`：会话标识（前端生成 UUID）
- `question`：用户问题
- `answer`：系统回复
- `status`：success/failed/pending
- `created_at` / `completed_at`：时间戳
- `error_message`：失败原因（可空）

#### 关系
- ProductItem 多对一 ImportBatch（已存在）
- QueryFilter 为前端查询参数，不入库
- ChatSession 与 ProductItem 无直接关联，但可在问答内容中引用筛选结果

## 成功指标

- **SC-001**：运营在数据洞察页面完成一次批次+状态联合筛选并查看首屏结果的时间≤5 秒，且返回结果准确率（与后端校验一致）≥95%。
- **SC-002**：80% 的常规筛选请求（含分页与排序）在 3 秒内完成，列表交互无明显卡顿。
- **SC-003**：chat 悬浮入口在页面加载后 1 秒内可见，≥90% 的发送请求在 10 秒内得到明确回复或错误提示。
- **SC-004**：用户可在同一页面完成筛选、查看详情与一次 chat 交互的任务成功率≥90%，且自我报告的满意度≥80%。

## 可观测性与快启

- **Instrumentation**：为列表查询、筛选、排序、分页、详情弹出、chat 打开/发送/失败分别记录耗时与成功率；对空态、错误态出现频次埋点，便于判断可用性。
- **Manual Verification**：quickstart 需覆盖“加载页面→组合筛选→查看详情→重置筛选→打开 chat 发送问题→模拟失败重试”的完整路径，并验证空态/错误态提示。
- **Owner**：运营产品负责人负责核查埋点和手动验证步骤，确保页面可用性与交互体验满足预期。
