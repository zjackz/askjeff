# AI 通用编程指南（模板）

> 建议放置位置：项目根目录 `AGENTS/`（便于跨项目复制）。

## MUST（开始前先确认；不清晰就提问）

- 目标与输出物（接口/页面/脚本/文档）
- 验收标准（≥3 条，含失败与边界）
- 约束（运行环境/联网/依赖与数据库/破坏性操作）
- 非目标（明确“不做什么”）

## MUST（默认执行步骤）

1) 读最近的 `AGENTS.md`（子目录优先）  
2) 用 `rg` 找入口与调用链，优先修根因  
3) 小步实现，保持 diff 最小，避免无关重构  
4) 先拆分再堆代码（见“规模控制”）  
5) 必须补测试（至少覆盖成功与失败）  
6) 必须跑 `lint`/`test`/`build`（先小后大）  
7) 交付说明：改动点/影响/验证命令/风险与回滚  

## MUST NOT（安全红线）

- 禁止硬编码密钥/Token/口令；禁止“可用默认值”；缺失必须 fail fast 并给中文提示
- 禁止日志/错误信息泄露密钥、PII、内部地址；只输出脱敏摘要与可排障上下文
- 禁止“猜测式修复”线上/联调问题；必须先查日志/复现/最小化用例
- 破坏性命令必须二次确认（清库、回滚、批量重写、`rm -rf`、`git reset --hard`）

## MUST（规模控制：防单文件爆炸）

- 页面/组件 ≤ 300 行（> 500 必须拆分）；路由/控制器 ≤ 300 行（> 500 必须拆分）；单函数 ≤ 80 行（> 120 必须拆分）
- 拆分优先级：UI → `components/`；状态/副作用 → `stores/`/`composables`（或 `services/`）；API 调用 → `src/api/`（或 `api/clients/`）
- 预计会超阈值：必须先输出“拆分清单（路径+职责）”，再开始写代码

## MUST（接口契约与错误码）

- 契约唯一来源：OpenAPI/接口文档；调用方不得猜路径/字段名或依赖代理 rewrite
- 版本前缀必须单一（如 `/api/v1`）；兼容旧路径必须给映射表与下线日期
- 必须维护错误码表（命名规则 + HTTP 映射 + 前端提示策略）；新增错误必须登记

## MUST（外部 API 客户端）

- 同一外部服务只能有一个客户端实现（超时/重试/退避/错误映射/日志字段/脱敏策略统一）
- 失败必须可排障：记录 `raw_response` 摘要 + 参数摘要 + 状态码 + 耗时 + 请求标识

## MUST（停止条件）

- 缺关键配置/密钥且无法安全提供：停止并说明如何配置；不得用临时默认值继续
- 接口前缀/错误结构多套并行且无迁移计划：停止并要求补齐策略
- 无法运行测试/静态检查：说明原因 + 提供替代验证，并在交付中标明风险

## 项目占位符（复制后填写）

- 启动：`<...>`
- 测试：`<...>`
- 静态检查：`<...>`
- 构建/发布：`<...>`
