<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¹¿å‘Šè¯Šæ–­ - æµ‹è¯•é¡µé¢</title>
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: #1e293b;
            color: #e2e8f0;
            padding: 20px;
        }
        .container { max-width: 1400px; margin: 0 auto; }
        h1 { margin-bottom: 10px; color: #fff; }
        .subtitle { color: #94a3b8; margin-bottom: 30px; }
        .chart-container {
            background: #0f172a;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.3);
        }
        #chart { width: 100%; height: 600px; }
        .stats {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
        }
        .stat-card {
            flex: 1;
            background: #0f172a;
            padding: 20px;
            border-radius: 8px;
            border-left: 4px solid #3b82f6;
        }
        .stat-value { font-size: 32px; font-weight: bold; margin-bottom: 5px; }
        .stat-label { color: #94a3b8; font-size: 14px; }
        .loading {
            text-align: center;
            padding: 40px;
            color: #94a3b8;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ¯ äºšé©¬é€Šå¹¿å‘Šé«˜é˜¶è¯Šæ–­</h1>
        <p class="subtitle">åŸºäº "åº“å­˜ x å¹¿å‘Š" åŒç»´åº¦çš„ç”Ÿæ„è¯Šæ–­çŸ©é˜µ</p>
        
        <div class="stats">
            <div class="stat-card">
                <div class="stat-value" id="totalSkus">-</div>
                <div class="stat-label">æ€» SKU æ•°</div>
            </div>
            <div class="stat-card" style="border-color: #ef4444;">
                <div class="stat-value" id="criticalCount">-</div>
                <div class="stat-label">Critical (éœ€æ¸…ä»“)</div>
            </div>
            <div class="stat-card" style="border-color: #22c55e;">
                <div class="stat-value" id="starCount">-</div>
                <div class="stat-label">Star (å¢é•¿ä¸­)</div>
            </div>
            <div class="stat-card" style="border-color: #3b82f6;">
                <div class="stat-value" id="potentialCount">-</div>
                <div class="stat-label">Potential (æ½œåŠ›)</div>
            </div>
        </div>

        <div class="chart-container">
            <div id="chart"></div>
        </div>
    </div>

    <script>
        async function loadData() {
            try {
                const response = await fetch('/api/v1/ads-analysis/matrix');
                const data = await response.json();
                
                // Update stats
                document.getElementById('totalSkus').textContent = data.length;
                document.getElementById('criticalCount').textContent = 
                    data.filter(d => d.status.includes('CRITICAL')).length;
                document.getElementById('starCount').textContent = 
                    data.filter(d => d.status.includes('STAR')).length;
                document.getElementById('potentialCount').textContent = 
                    data.filter(d => d.status.includes('POTENTIAL')).length;
                
                // Initialize chart
                const chart = echarts.init(document.getElementById('chart'), 'dark');
                
                const option = {
                    backgroundColor: 'transparent',
                    tooltip: {
                        trigger: 'item',
                        formatter: (params) => {
                            const d = params.data;
                            return `<div style="padding: 10px;">
                                <div style="font-weight: bold; margin-bottom: 8px;">${d.sku}</div>
                                <div>åº“å­˜: ${d.stock_weeks.toFixed(1)} å‘¨</div>
                                <div>TACOS: ${d.tacos.toFixed(1)}%</div>
                                <div>é”€å”®é¢: $${d.sales.toFixed(0)}</div>
                                <div style="margin-top: 8px; color: ${getStatusColor(d.status)};">
                                    ${d.status}
                                </div>
                            </div>`;
                        }
                    },
                    grid: {
                        left: '10%',
                        right: '10%',
                        bottom: '15%',
                        top: '10%'
                    },
                    xAxis: {
                        name: 'åº“å­˜å‘¨è½¬ (å‘¨)',
                        nameLocation: 'middle',
                        nameGap: 30,
                        type: 'value',
                        splitLine: { lineStyle: { color: '#334155' } }
                    },
                    yAxis: {
                        name: 'TACOS (%)',
                        nameLocation: 'middle',
                        nameGap: 50,
                        type: 'value',
                        splitLine: { lineStyle: { color: '#334155' } }
                    },
                    series: [{
                        type: 'scatter',
                        symbolSize: 14,
                        data: data.map(item => ({
                            value: [item.stock_weeks, item.tacos],
                            ...item,
                            itemStyle: {
                                color: getStatusColor(item.status)
                            }
                        })),
                        markArea: {
                            silent: true,
                            itemStyle: { opacity: 0.08 },
                            data: [
                                [{name: 'CRITICAL', xAxis: 24, yAxis: 20, itemStyle: {color: '#ef4444'}}, {xAxis: 60, yAxis: 60}],
                                [{name: 'STAR', xAxis: 24, yAxis: 0, itemStyle: {color: '#22c55e'}}, {xAxis: 60, yAxis: 20}],
                                [{name: 'POTENTIAL', xAxis: 0, yAxis: 0, itemStyle: {color: '#3b82f6'}}, {xAxis: 24, yAxis: 20}],
                                [{name: 'DROP', xAxis: 0, yAxis: 20, itemStyle: {color: '#6b7280'}}, {xAxis: 24, yAxis: 60}]
                            ]
                        }
                    }]
                };
                
                chart.setOption(option);
                window.addEventListener('resize', () => chart.resize());
                
            } catch (error) {
                console.error('Failed to load data:', error);
                document.getElementById('chart').innerHTML = 
                    '<div class="loading">âŒ æ•°æ®åŠ è½½å¤±è´¥: ' + error.message + '</div>';
            }
        }
        
        function getStatusColor(status) {
            if (status.includes('CRITICAL')) return '#ef4444';
            if (status.includes('STAR')) return '#22c55e';
            if (status.includes('POTENTIAL')) return '#3b82f6';
            return '#9ca3af';
        }
        
        loadData();
    </script>
</body>
</html>
