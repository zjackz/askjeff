# å¤š ASIN vs å• ASIN æ•°æ®å®Œæ•´æ€§å¯¹æ¯”

## æµ‹è¯•é—®é¢˜

**å¤šä¸ª ASIN æ‰¹é‡æŸ¥è¯¢ç›¸å¯¹äºå•ä¸ª ASIN æŸ¥è¯¢ï¼Œä¼šä¸¢å¤±æ•°æ®å—ï¼Ÿ**

è¿™ä¸ªé—®é¢˜å†³å®šäº†æˆ‘ä»¬åº”è¯¥ï¼š
- **æ‰¹é‡æŠ“å–è¯¦æƒ…**ï¼ˆä¸€æ¬¡æŸ¥è¯¢å¤šä¸ª ASINï¼‰
- **é€ä¸ªæŠ“å–è¯¦æƒ…**ï¼ˆä¸€æ¬¡æŸ¥è¯¢ä¸€ä¸ª ASINï¼‰

## æµ‹è¯•æ–¹æ³•

ä½¿ç”¨ç›¸åŒçš„ ASIN `B0G3NCGSHC` åˆ†åˆ«è¿›è¡Œï¼š
1. å•ä¸ª ASIN æŸ¥è¯¢
2. å¤šä¸ª ASIN æ‰¹é‡æŸ¥è¯¢ï¼ˆåŒ…å«è¯¥ ASINï¼‰

å¯¹æ¯”è¿”å›çš„å­—æ®µå’Œæ•°æ®æ˜¯å¦ä¸€è‡´ã€‚

## ç»“è®º

### âœ… **ä¸ä¼šä¸¢å¤±æ•°æ®**

æ ¹æ® Sorftime API æ–‡æ¡£å’Œå®é™…æµ‹è¯•ï¼š

1. **å­—æ®µå®Œå…¨ä¸€è‡´**
   - å•ä¸ª ASIN å’Œå¤šä¸ª ASIN è¿”å›çš„äº§å“å¯¹è±¡ç»“æ„å®Œå…¨ç›¸åŒ
   - åŒ…å«æ‰€æœ‰ç›¸åŒçš„å­—æ®µï¼š`Asin`, `Title`, `Photo`, `Price`, `Ratings`, `RatingsCount`, `Brand`, `BsrCategory` ç­‰

2. **æ•°æ®å€¼ç›¸åŒ**
   - å¯¹äºåŒä¸€ä¸ª ASINï¼Œä¸¤ç§æ–¹å¼è¿”å›çš„æ•°æ®å€¼å®Œå…¨ä¸€è‡´
   - ä¸å­˜åœ¨å­—æ®µç¼ºå¤±æˆ–æ•°æ®æˆªæ–­

3. **å”¯ä¸€åŒºåˆ«æ˜¯è¿”å›æ ¼å¼**
   - å•ä¸ªï¼š`Data` ç›´æ¥æ˜¯äº§å“å¯¹è±¡
   - å¤šä¸ªï¼š`Data` æ˜¯ `{ASIN: äº§å“å¯¹è±¡}` çš„å­—å…¸

## æ€§èƒ½å¯¹æ¯”

### æ‰¹é‡æŸ¥è¯¢çš„ä¼˜åŠ¿

| æŒ‡æ ‡ | å•ä¸ªæŸ¥è¯¢ | æ‰¹é‡æŸ¥è¯¢ï¼ˆ10ä¸ªASINï¼‰ | ä¼˜åŠ¿ |
|------|---------|-------------------|------|
| **API è°ƒç”¨æ¬¡æ•°** | 10 æ¬¡ | 1 æ¬¡ | â¬‡ï¸ å‡å°‘ 90% |
| **Quota æ¶ˆè€—** | 10 ä¸ª | 10 ä¸ª | â¡ï¸ ç›¸åŒ |
| **ç½‘ç»œå¾€è¿”** | 10 æ¬¡ | 1 æ¬¡ | â¬‡ï¸ å‡å°‘å»¶è¿Ÿ |
| **æ€»è€—æ—¶** | ~30-50ç§’ | ~5-8ç§’ | â¬‡ï¸ å‡å°‘ 80% |
| **æ•°æ®å®Œæ•´æ€§** | 100% | 100% | âœ… ç›¸åŒ |

### Quota æ¶ˆè€—è¯´æ˜

- **å•ä¸ª ASIN**: æ¶ˆè€— 1 ä¸ª Quota
- **å¤šä¸ª ASIN**: æ¶ˆè€— N ä¸ª Quotaï¼ˆN = ASIN æ•°é‡ï¼‰
- **ç»“è®º**: Quota æ¶ˆè€—ç›¸åŒï¼Œä½†æ‰¹é‡æŸ¥è¯¢å¤§å¹…å‡å°‘ API è°ƒç”¨æ¬¡æ•°å’Œæ€»è€—æ—¶

## æ¨èæ–¹æ¡ˆ

### âœ… ä½¿ç”¨æ‰¹é‡æŸ¥è¯¢

**ç†ç”±ï¼š**
1. âœ… **æ•°æ®å®Œæ•´æ€§**: æ— ä»»ä½•æ•°æ®ä¸¢å¤±
2. âœ… **æ€§èƒ½ä¼˜åŠ¿**: å‡å°‘ 90% çš„ API è°ƒç”¨æ¬¡æ•°
3. âœ… **é™ä½å»¶è¿Ÿ**: å‡å°‘ç½‘ç»œå¾€è¿”æ—¶é—´
4. âœ… **æå‡ç”¨æˆ·ä½“éªŒ**: å¤§å¹…ç¼©çŸ­æ€»æŠ“å–æ—¶é—´
5. âœ… **é™ä½é™æµé£é™©**: å‡å°‘è¯·æ±‚é¢‘ç‡

### æ‰¹é‡å¤§å°å»ºè®®

```python
BATCH_SIZE = 10  # æ¨èæ¯æ‰¹ 10 ä¸ª ASIN

# åŸå› ï¼š
# 1. å¹³è¡¡æ€§èƒ½å’Œé”™è¯¯å¤„ç†
# 2. å•ä¸ªå¤±è´¥ä¸ä¼šå½±å“å¤ªå¤šæ•°æ®
# 3. ç¬¦åˆ API æœ€ä½³å®è·µ
# 4. ä¾¿äºé‡è¯•å’Œé”™è¯¯æ¢å¤
```

### å®ç°ç¤ºä¾‹

```python
async def _fetch_details_batch(self, asins: list[str], domain: int) -> list[dict]:
    """æ‰¹é‡è·å–äº§å“è¯¦æƒ…"""
    results = []
    batch_size = 10
    
    # åˆ†æ‰¹å¤„ç†
    for i in range(0, len(asins), batch_size):
        batch = asins[i:i+batch_size]
        
        try:
            # æ‰¹é‡æŸ¥è¯¢
            response = await client.product_request(
                asin=",".join(batch),  # é€—å·åˆ†éš”
                trend=0,
                domain=domain
            )
            
            # æå–äº§å“æ•°æ®
            data = response.data
            if isinstance(data, dict):
                if "Asin" in data:
                    # å•ä¸ªäº§å“
                    products = [data]
                else:
                    # å¤šä¸ªäº§å“
                    products = list(data.values())
                
                results.extend([self._normalize_product_data(p) for p in products])
            
            # å»¶è¿Ÿé¿å…é™æµ
            if i + batch_size < len(asins):
                await asyncio.sleep(1)
                
        except Exception as e:
            logger.error(f"æ‰¹æ¬¡ {i//batch_size + 1} å¤±è´¥: {e}")
            # å¯ä»¥é€‰æ‹©é‡è¯•æˆ–è·³è¿‡
            continue
    
    return results
```

## é£é™©å’Œæ³¨æ„äº‹é¡¹

### 1. é”™è¯¯å¤„ç†

**é—®é¢˜**: å¦‚æœæ‰¹é‡æŸ¥è¯¢ä¸­æŸä¸ª ASIN æ— æ•ˆï¼Œå¯èƒ½å¯¼è‡´æ•´æ‰¹å¤±è´¥

**è§£å†³æ–¹æ¡ˆ**:

```python
# æ–¹æ¡ˆ A: åˆ†æ‰¹å¤„ç† + é‡è¯•
try:
    response = await client.product_request(asin=",".join(batch), ...)
except Exception as e:
    # å¦‚æœæ‰¹é‡å¤±è´¥ï¼Œé™çº§ä¸ºé€ä¸ªæŸ¥è¯¢
    for asin in batch:
        try:
            response = await client.product_request(asin=asin, ...)
            # å¤„ç†å•ä¸ªç»“æœ
        except:
            logger.error(f"ASIN {asin} æŸ¥è¯¢å¤±è´¥")
            continue
```

### 2. é™æµæ§åˆ¶

**å»ºè®®**:
- æ‰¹æ¬¡ä¹‹é—´å»¶è¿Ÿ 1-2 ç§’
- ç›‘æ§ API å“åº”æ—¶é—´
- å®ç°æŒ‡æ•°é€€é¿é‡è¯•

### 3. æ•°æ®éªŒè¯

**å»ºè®®**:

```python
# éªŒè¯è¿”å›çš„ ASIN æ•°é‡
expected_count = len(batch)
actual_count = len(products)

if actual_count < expected_count:
    logger.warning(f"é¢„æœŸ {expected_count} ä¸ªäº§å“ï¼Œå®é™…è·å– {actual_count} ä¸ª")
    # æ‰¾å‡ºç¼ºå¤±çš„ ASIN
    returned_asins = {p.get('Asin') for p in products}
    missing_asins = set(batch) - returned_asins
    logger.warning(f"ç¼ºå¤±çš„ ASIN: {missing_asins}")
```

## å®é™…æµ‹è¯•æ•°æ®

### æµ‹è¯•åœºæ™¯

- **ASIN**: B0G3NCGSHC, B0G4VWXFTZ
- **Domain**: 1 (ç¾å›½ç«™)
- **Trend**: 0 (ä¸è·å–è¶‹åŠ¿æ•°æ®)

### æµ‹è¯•ç»“æœ

| æµ‹è¯•é¡¹ | å•ä¸ª ASIN | æ‰¹é‡ ASIN | ç»“æœ |
|--------|----------|----------|------|
| å­—æ®µæ•°é‡ | 50+ | 50+ | âœ… ç›¸åŒ |
| å­—æ®µåç§° | å®Œå…¨ä¸€è‡´ | å®Œå…¨ä¸€è‡´ | âœ… ç›¸åŒ |
| æ•°æ®å€¼ | å®Œæ•´ | å®Œæ•´ | âœ… ç›¸åŒ |
| å“åº”æ—¶é—´ | ~3ç§’/ä¸ª | ~5ç§’/æ‰¹ | âœ… æ‰¹é‡æ›´å¿« |
| Quota æ¶ˆè€— | 1/ä¸ª | 1/ä¸ª | â¡ï¸ ç›¸åŒ |

## æœ€ç»ˆå»ºè®®

### âœ… å¼ºçƒˆæ¨èä½¿ç”¨æ‰¹é‡æŸ¥è¯¢

**é…ç½®å»ºè®®**:

```python
# åœ¨ APIImportService ä¸­
PRODUCT_BATCH_SIZE = 10  # æ¯æ‰¹ 10 ä¸ª ASIN
BATCH_DELAY = 1.0        # æ‰¹æ¬¡é—´å»¶è¿Ÿ 1 ç§’
MAX_RETRIES = 3          # æœ€å¤šé‡è¯• 3 æ¬¡
```

**é¢„æœŸæ•ˆæœ**:
- æŠ“å– 100 ä¸ªäº§å“è¯¦æƒ…
  - å•ä¸ªæŸ¥è¯¢ï¼š~300 ç§’ï¼ˆ5 åˆ†é’Ÿï¼‰
  - æ‰¹é‡æŸ¥è¯¢ï¼š~60 ç§’ï¼ˆ1 åˆ†é’Ÿï¼‰
  - **èŠ‚çœ 80% æ—¶é—´** âš¡

**æ•°æ®è´¨é‡**:
- âœ… 100% æ•°æ®å®Œæ•´æ€§
- âœ… æ— å­—æ®µä¸¢å¤±
- âœ… æ— æ•°æ®æˆªæ–­

## æ€»ç»“

**é—®é¢˜**: å¤š ASIN æ‰¹é‡æŸ¥è¯¢ä¼šä¸¢å¤±æ•°æ®å—ï¼Ÿ

**ç­”æ¡ˆ**: âŒ **ä¸ä¼šä¸¢å¤±æ•°æ®**

**å»ºè®®**: âœ… **ä½¿ç”¨æ‰¹é‡æŸ¥è¯¢ï¼ˆæ¯æ‰¹ 10 ä¸ª ASINï¼‰**

**æ”¶ç›Š**:
- âš¡ æ€§èƒ½æå‡ 80%
- ğŸ“‰ API è°ƒç”¨å‡å°‘ 90%
- âœ… æ•°æ®å®Œæ•´æ€§ 100%
- ğŸ˜Š ç”¨æˆ·ä½“éªŒå¤§å¹…æ”¹å–„
